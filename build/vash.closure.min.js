var l = null, u = !1, U = function(g) {
  function e(a) {
    return new e.d.G(a)
  }
  function p(a) {
    this.input = a.replace(/\r\n|\r/g, "\n");
    this.H = 1;
    this.h = 0
  }
  function j(a, b) {
    this.options = b || {};
    this.c = a;
    this.a = e(F)
  }
  function G(a, b) {
    this.a = a;
    this.ra = b || ""
  }
  g.version = "0.4.3-880";
  g.config = {useWith:u, modelName:"model", debug:u, debugParser:u, debugCompiler:u};
  p.prototype = {va:function(a, b) {
    return{type:a, m:this.H, p:this.h, f:b, toString:function() {
      return"[" + this.type + " (" + this.m + "," + this.p + "): " + this.f + "]"
    }}
  }, b:function(a, b) {
    var c, d;
    if(c = a.exec(this.input)) {
      return this.ka(c[0].length), d = this.va(b, c[1]), this.h += c[0].length, d
    }
  }, ta:function(a) {
    this.input = a + this.input;
    this.h -= a.length
  }, ka:function(a) {
    this.input = this.input.substr(a)
  }, t:function(a, b) {
    var c;
    a && (c = a.f.split(b), 1 < c.length && (a.f = c.shift(), this.ta(b + c.join(b))));
    return a
  }, advance:function() {
    return this.next()
  }, next:function() {
    return this.Q() || this.v() || this.M() || this.L() || this.K() || this.R() || this.B() || this.da() || this.A() || this.T() || this.w() || this.O() || this.ga() || this.fa() || this.X() || this.W() || this.V() || this.ea() || this.aa() || this.ha() || this.S() || this.Z() || this.U() || this.Y() || this.ca() || this.J() || this.$() || this.N() || this.z() || this.C() || this.ba() || this.P()
  }, K:function() {
    return this.b(/^(@)/, h)
  }, L:function() {
    return this.b(/^@\:/, V)
  }, v:function() {
    return this.b(/^(@\*)/, H)
  }, M:function() {
    return this.b(/^(\*@)/, I)
  }, B:function() {
    return this.b(/^(\()/, m)
  }, da:function() {
    return this.b(/^(\))/, W)
  }, w:function() {
    return this.b(/^(\{)/, k)
  }, O:function() {
    return this.b(/^(\})/, J)
  }, A:function() {
    return this.b(/^(\[)/, K)
  }, T:function() {
    return this.b(/^(\])/, X)
  }, ga:function() {
    return this.b(/^(<text>)/, L)
  }, fa:function() {
    return this.b(/^(<\/text>)/, M)
  }, X:function() {
    return this.t(this.b(/^(<[^>]+?\/>)/, N), "@")
  }, W:function() {
    return this.t(this.b(/^(<[^\/ >]+?[^>]*?>)/, B), "@")
  }, V:function() {
    return this.t(this.b(/^(<\/[^>\b]+?>)/, C), "@")
  }, R:function() {
    return this.b(/^(\(.*?\)?\s*?=>)/, O)
  }, S:function() {
    return this.b(/^(function)(?![\d\w])/, t)
  }, Z:function() {
    return this.b(/^(case|catch|do|else|finally|for|function|goto|if|instanceof|return|switch|try|typeof|var|while|with)(?![\d\w])/, n)
  }, Y:function() {
    return this.b(/^([_$a-zA-Z\xA0-\uFFFF][_$a-zA-Z0-9\xA0-\uFFFF]*)/, D)
  }, U:function() {
    return this.b(/^(vash\.raw)(?![\d\w])/, v)
  }, ea:function() {
    return this.b(/^(\.)/, E)
  }, Q:function() {
    return this.b(/^([a-zA-Z0-9._%-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4})\b/, ba)
  }, J:function() {
    return this.b(/^(\|=|\^=|&=|>>>=|>>=|<<=|-=|\+=|%=|\/=|\*=|=)/, Y)
  }, ca:function() {
    return this.b(/^(===|!==|==|!==|>>>|<<|>>|>=|<=|>|<|\+|-|\/|\*|\^|%|\:|\?)/, Z)
  }, $:function() {
    return this.b(/^(&&|\|\||&|\||\^)/, $)
  }, C:function() {
    return this.b(/^(')/, P)
  }, z:function() {
    return this.b(/^(")/, Q)
  }, N:function() {
    return this.b(/^(\\)/, R)
  }, ba:function() {
    return this.b(/^([0-9]+)/, aa)
  }, P:function() {
    return this.b(/^([^\s})@.]+?)/, ca)
  }, ha:function() {
    return this.b(/^(\s)/, q)
  }, aa:function() {
    var a = this.b(/^(\n)/, S);
    a && (this.H++, this.h = 0);
    return a
  }};
  var h = "AT", H = "AT_STAR_OPEN", I = "AT_STAR_CLOSE", V = "AT_COLON", ba = "EMAIL", m = "PAREN_OPEN", W = "PAREN_CLOSE", k = "BRACE_OPEN", J = "BRACE_CLOSE", K = "HARD_PAREN_OPEN", X = "HARD_PAREN_CLOSE", L = "TEXT_TAG_OPEN", M = "TEXT_TAG_CLOSE", N = "HTML_TAG_SELFCLOSE", B = "HTML_TAG_OPEN", C = "HTML_TAG_CLOSE", n = "KEYWORD", t = "FUNCTION", O = "FAT_ARROW", D = "IDENTIFIER", E = "PERIOD", Y = "ASSIGN_OPERATOR", P = "SINGLE_QUOTE", Q = "DOUBLE_QUOTE", R = "BACKSLASH", aa = "NUMERIC_CONTENT", 
  Z = "OPERATOR", $ = "LOGICAL", ca = "CONTENT", q = "WHITESPACE", S = "NEWLINE", v = "HTML_RAW";
  p.r = {v:I, B:W, w:J, A:X, z:Q, C:P};
  e.prototype.G = function(a) {
    "string" === typeof a && (this.mode = a);
    this.n()
  };
  e.d = e.prototype.G.prototype = e.prototype;
  e.d.g = "yep";
  e.d.constructor = e;
  e.d.length = 0;
  e.d.parent = l;
  e.d.mode = l;
  e.d.tagName = l;
  e.d.e = function(a, b) {
    var c = e();
    c.mode = a;
    c.parent = this;
    this.push(c);
    b && (c.tagName = b);
    this.n();
    return c
  };
  e.d.ja = function(a) {
    for(var b = this;b;) {
      if(b.tagName !== a && b.parent) {
        b = b.parent
      }else {
        break
      }
    }
    return b
  };
  e.d.s = function(a) {
    for(var b;1 === a.length && a[0].g;) {
      a = a[0]
    }
    if(a.mode !== F) {
      this.push(a)
    }else {
      for(b = 0;b < a.length;b++) {
        this.push(a[b])
      }
    }
    this.n()
  };
  e.d.push = function(a) {
    e.isArray(a) ? (a.g && a.forEach(function(a) {
      a.parent = this
    }, this), Array.prototype.push.apply(this, a)) : (a.g && (a.parent = this), Array.prototype.push.call(this, a));
    this.n();
    return this.length
  };
  e.d.root = function() {
    for(var a = this;a && a.parent && (a = a.parent);) {
    }
    return a
  };
  e.d.I = function() {
    function a(d) {
      var y;
      b.push(Array(c).join(" |") + " +" + d.mode + " " + (d.tagName || ""));
      c += 1;
      for(d = d.slice();y = d.shift();) {
        y.g === e.d.g ? a(y) : b.push(Array(c).join(" |") + " " + (y ? y.toString() : "[empty]"))
      }
      c -= 1
    }
    var b = [], c = 1;
    a(this);
    return b.join("\n")
  };
  e.d.n = function() {
    if(this.length >= e.qa) {
      var a = Error();
      a.message = "Maximum number of elements exceeded";
      a.name = "vQueryDepthException";
      throw a;
    }
  };
  e.qa = 1E3;
  e.pa = function(a) {
    return a = Array.prototype.slice.call(a, 0)
  };
  e.isArray = function(a) {
    return"[object Array]" == Object.prototype.toString.call(a)
  };
  e.F = function(a) {
    var b = {}, c;
    for(c in a) {
      Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c])
    }
    return b
  };
  e.ua = function() {
    for(var a = "pop,push,reverse,shift,sort,splice,unshift,concat,join,slice,indexOf,lastIndexOf,filter,forEach,every,map,some,reduce,reduceRight".split(","), b = [], c, d = 0;d < a.length;d++) {
      if(c = a[d], "function" === typeof b[c]) {
        e.d[c] || function(a) {
          e.d[a] = function() {
            return b[a].apply(this, e.pa(arguments))
          }
        }(c)
      }else {
        throw Error("Vash requires ES5 array iteration methods, missing: " + c);
      }
    }
  };
  e.ua();
  var F = "PROGRAM", w = "MARKUP", i = "BLOCK", f = "EXPRESSION";
  j.prototype = {parse:function() {
    for(var a;a = this.c.pop();) {
      this.options.k && console.log(this.a && this.a.mode, a.type, a, a.f);
      if(this.a.mode === F || this.a.mode === l) {
        this.a = this.a.e(this.options.l || w), this.options.l === f && (this.a = this.a.e(f))
      }
      this.a.mode === w ? this.oa(a) : this.a.mode === i ? this.ma(a) : this.a.mode === f && this.na(a)
    }
    this.a = this.a.root();
    this.options.k && !this.options.l && (console.log(this.a), console.log(this.a.I()));
    return this.a
  }, la:function(a, b, c) {
    "UNMATCHED" == b && (a.name = "UnmatchedCharacterError", this.a.root(), c && (a.message = "Unmatched " + c.type + " at line " + c.m + ", character " + c.p + ". Value: " + c.f + "\n " + this.a.I(), a.lineNumber = c.m));
    return a
  }, D:function(a) {
    for(var b, c = [];b = this.c[this.c.length - 1];) {
      if(b.type === a) {
        b = this.c.pop(), c.push(b)
      }else {
        break
      }
    }
    return c
  }, i:function(a, b, c, d, e) {
    for(var d = a, f = l, g = 0, i = 0, h = [];d;) {
      d.type === b ? f && f.type !== escape && b !== c || !f ? g++ : b === c && i++ : d.type === c && (i++, f && f.type === e && i--);
      h.push(d);
      if(g === i) {
        break
      }
      f = d;
      d = this.c.pop();
      if(!d) {
        throw this.la(Error(), "UNMATCHED", a);
      }
    }
    return h.reverse()
  }, oa:function(a) {
    var b = this.c[this.c.length - 1], c = this.c[this.c.length - 2], d = l;
    switch(a.type) {
      case H:
        this.i(a, H, I, h, h);
        break;
      case h:
        if(b) {
          switch(b.type) {
            case m:
            ;
            case D:
            ;
            case v:
              0 === this.a.length && (this.a = this.a.parent, this.a.pop());
              this.a = this.a.e(f);
              break;
            case n:
            ;
            case t:
            ;
            case k:
              0 === this.a.length && (this.a = this.a.parent, this.a.pop());
              this.a = this.a.e(i);
              break;
            default:
              this.a.push(this.c.pop())
          }
        }
        break;
      case k:
        this.a = this.a.e(i);
        this.c.push(a);
        break;
      case J:
        this.a = this.a.parent;
        this.c.push(a);
        break;
      case L:
      ;
      case B:
        d = a.f.match(/^<([^\/ >]+)/i);
        d === l && b && b.type === h && c && (d = c.f.match(/(.*)/));
        this.a.tagName ? this.a = this.a.e(w, d[1]) : this.a.tagName = d[1];
        B === a.type && this.a.push(a);
        break;
      case M:
      ;
      case C:
        d = a.f.match(/^<\/([^>]+)/i);
        d === l && b && b.type === h && c && (d = c.f.match(/(.*)/));
        c = this.a.ja(d[1]);
        c === l || c.tagName !== d[1] || (this.a = c);
        C === a.type && this.a.push(a);
        if(this.a.parent && this.a.parent.mode === i && (b.type === q || b.type === S)) {
          this.a = this.a.parent
        }
        break;
      case N:
        this.a.push(a);
        if(this.a.parent && this.a.parent.mode === i && (b.type === q || b.type === S)) {
          this.a = this.a.parent
        }
        break;
      default:
        this.a.push(a)
    }
  }, ma:function(a) {
    var b = this.c[this.c.length - 1], c, d;
    switch(a.type) {
      case h:
        b.type !== h && (this.c.push(a), this.a = this.a.e(w));
        break;
      case V:
        this.a = this.a.e(w);
        break;
      case L:
      ;
      case M:
      ;
      case N:
      ;
      case B:
      ;
      case C:
        this.a = this.a.e(w);
        this.c.push(a);
        break;
      case O:
        this.a = this.a.e(i);
        break;
      case k:
      ;
      case m:
        d = e.F(this.options);
        d.l = i;
        c = this.i(a, a.type, p.r[a.type], l, h);
        c.pop();
        b = c.shift();
        this.a.push(a);
        c = new j(c, d);
        c.parse();
        this.a.s(c.a);
        this.a.push(b);
        c = this.D(q);
        (b = this.c[this.c.length - 1]) && b.type !== n && b.type !== t && b.type !== k && a.type !== m ? (this.c.push.apply(this.c, c.reverse()), this.a = this.a.parent) : this.a.push(c);
        break;
      case q:
        this.a.push(a);
        this.D(q);
        break;
      default:
        this.a.push(a)
    }
  }, na:function(a) {
    var b = l, c, d;
    switch(a.type) {
      case n:
      ;
      case t:
        this.a = this.a.e(i);
        this.c.push(a);
        break;
      case q:
      ;
      case $:
      ;
      case Y:
      ;
      case Z:
      ;
      case aa:
        this.a.parent && this.a.parent.mode === f ? this.a.push(a) : (this.a = this.a.parent, this.c.push(a));
        break;
      case D:
      ;
      case v:
        this.a.push(a);
        break;
      case P:
      ;
      case Q:
        this.a.parent && this.a.parent.mode === f ? (d = this.i(a, a.type, p.r[a.type], R, R), this.a.s(d.reverse())) : (this.a = this.a.parent, this.c.push(a));
        break;
      case K:
      ;
      case m:
        c = e.F(this.options);
        c.l = f;
        d = this.i(a, a.type, p.r[a.type], l, h);
        d.pop();
        b = d.shift();
        this.a.push(a);
        a = new j(d, c);
        a.parse();
        this.a.s(a.a);
        this.a.push(b);
        b = this.c[this.c.length - 1];
        this.a.parent && this.a.parent.mode !== f && b && b.type !== K && b.type !== E && (this.a = this.a.parent);
        break;
      case k:
        this.c.push(a);
        this.a = this.a.e(i);
        break;
      case O:
        this.c.push(a);
        this.a = this.a.e(i);
        break;
      case E:
        (b = this.c[this.c.length - 1]) && (b.type === D || b.type === n || b.type === t || b.type === E) ? this.a.push(a) : (this.a = this.a.parent, this.c.push(a));
        break;
      default:
        this.a.parent && this.a.parent.mode !== f ? (this.a = this.a.parent, this.c.push(a)) : this.a.push(a)
    }
  }};
  var T = G.prototype;
  T.ia = function(a) {
    function b(b) {
      a.debug && (e.push("__vl = " + b.m + ", "), e.push("__vc = " + b.p + "; \n"))
    }
    function c(r) {
      var k = r.slice(0), m, j, o;
      r.mode === f && r.parent && r.parent.mode !== f && (m = r.filter(d).length);
      for(j = 0;j < k.length;j++) {
        if(o = k[j], o.g) {
          c(o)
        }else {
          if(r.mode === w) {
            b(o), e.push("__vo.push('" + o.f.replace(h, '"').replace(q, "\\n") + "'); \n")
          }else {
            if(r.mode === i) {
              e.push(o.f.replace(h, '"'))
            }else {
              if(r.mode === f) {
                var s = r, x = j, t = 0 < m ? u : !0, n = "", z = "", A = s.parent && s.parent.mode !== f;
                a.xa !== u && (o.type === v && g.push(!0), A && 0 === x && t && 0 === g.length && (n += "( typeof (__vt = "), A && x === s.length - 1 && t && (0 < g.length ? g.pop() : z += ") !== 'undefined' ? __vt : '' ).toString()\n.replace(/&(?!w+;)/g, '&amp;')\n.replace(/</g, '&lt;')\n.replace(/>/g, '&gt;')\n.replace(/\"/g, '&quot;') \n"));
                if(A && (0 === x || 1 === x && s[0].type === v)) {
                  b(o), n = "__vo.push(" + n
                }
                if(A && (x === s.length - 1 || x === s.length - 2 && s[s.length - 1].type === v)) {
                  z += "); \n"
                }
                o.type !== v && e.push(n + o.f.replace(h, '"').replace(p, '"') + z);
                A && x === s.length - 1 && b(o)
              }
            }
          }
        }
      }
    }
    function d(a) {
      return a.g && a.mode === f ? 0 < a.filter(d).length : a.g && a.mode !== f ? !0 : u
    }
    var a = a || {}, e = [], g = [], h = /["']/gi, p = /(\\?)(["'])/gi, q = /[\n\r]/gi, k, j;
    e.unshift("var __vo = [], __vt; \n");
    a.debug && e.push("var __vl = 0, __vc = 0; \n");
    c(this.a);
    !0 === a.u && (e.unshift("with(" + a.o + " || {}){ \n"), e.push("}"));
    a.debug && (e.unshift("try { \n"), e.push("} catch(e){ (", T.sa.toString(), ")(e, __vl, __vc, ", '"' + this.ra.replace(q, "!LB!").replace(p, "\\$2") + '"', ") } \n"));
    e.push("return __vo.join('');");
    k = e.join("");
    a.q && console.log(k);
    try {
      j = new Function(a.o, k)
    }catch(m) {
      throw m.message += " -> " + k, m;
    }
    return j
  };
  T.sa = function(a, b, c, d) {
    var d = d.split("!LB!"), e = Math.max(0, b - 3), f = Math.min(d.length, b + 3), d = d.slice(e, f).map(function(a, c) {
      var d = c + e + 1;
      return(d === b ? "  > " : "    ") + d + " | " + a
    }).join("\n");
    a.message = "Problem while rendering template at line " + b + ", character " + c + ".\nOriginal message: " + a.message + ".\nContext: \n\n" + d + "\n\n";
    throw a;
  };
  g.VLexer = p;
  g.VParser = j;
  g.VCompiler = G;
  g.compile = function(a, b) {
    if("" === a || "string" !== typeof a) {
      throw Error("Empty or non-string cannot be compiled");
    }
    var c, d, e = [], b = b || {};
    b.u = b.u || g.j.u;
    b.o = b.o || g.j.o;
    b.debug = b.debug || g.j.debug;
    b.k = b.k || g.j.k;
    b.q = b.q || g.j.q;
    for(c = new p(a);d = c.advance();) {
      e.push(d)
    }
    e.reverse();
    c = new j(e, b);
    c.parse();
    c = (new G(c.a, a)).ia(b);
    c.wa = "render";
    return c
  };
  return g
}({});
"function" === typeof define && define.amd ? define(U) : "object" === typeof module && module.exports ? module.exports = U : window.vash = U;

